name: Daily Google Scholar Scrape

on:
  # Triggers the workflow every day at 14:00 UTC (roughly 7:00 AM PDT/PST)
  schedule:
    - cron: '03 19 * * *'
  # Allows manual triggering from the Actions tab in GitHub
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:

      - name: Install uv
        uses: astral-sh/setup-uv@v7

      - name: Set up Python
        run: uv python install

      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Install uv globally
        # Install the uv package so it can be called in the next step
        run: pip install uv

      - name: ğŸ“¦ Install dependencies (using uv)
        run: |
          uv sync

      - name: ğŸš€ Run the scraper script
        # This generates citations_history.csv
        run: uv run scrape.py 

      - name: ğŸ“Š Run the plotting script
      # This generates top_10_citations_plot.png
        run: uv run plotting.py

      - name: ğŸ’¾ Commit and Push results
        # IMPORTANT: This commits the generated files back to your repository.
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ¤– Automated update: data and plot'
          # Commit both the data file and the plot image file
          file_pattern: |
            citations_history.csv
            citations_wide_format.csv
            top_10_citations_plot.png
          branch: main